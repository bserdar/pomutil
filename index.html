<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>pomutil by bserdar</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Pomutil</h1>
        <p>Deal with large Maven projects</p>

        <p class="view"><a href="https://github.com/bserdar/pomutil">View the Project on GitHub <small>bserdar/pomutil</small></a></p>


<a href="https://github.com/bserdar/pomutil/zipball/master">Source ZIP File</a><br/>
<a href="https://github.com/bserdar/pomutil/tarball/master">Source TAR Ball</a><br/>
<a href="pomutils-2.2.0-dist.tar.gz">Distribution TAR BALL</a><br/>
<a href="pomutils-2.2.0-1.noarch.rpm">Distribution RPM</a>
      </header>
      <section>
Pomutil helps deal with large Maven projects. For general usage, read
the <a
href="https://github.com/bserdar/pomutil/blob/master/README">README</a>
file.

<h3>Versioning Artifacts</h3> 

Pomutil can be used to change the version numbers of some or all of
the artifacts built in a project tree.

<ol>
<li>Print current versions of artifacts to a text file.<br/>
<code>
    pomutil pom.xml -p>versions
</code>
</li>
<li>Edit the text file to reflect the new versions for artifacts.</li>
<li>Set artifact version numbers<br/>
<code>
   pomutil pom.xml -fversions
</code>
</li>
</ol>

This will change the version numbers of the artifacts to that's given
in the <code>versions</code> file, and also change the version numbers
of the dependency declerations to those artifacts in other POM files.

<h3>Building only what is necessary</h3>

<p>When working with a large project structure, building everything
from the root is usually unnecessary. What is required is to build
everything that will be release, and everything that depends on those,
so that all the modifications to the artifacts are incorporated into
affected modules. Pomutils can be used to setup such a build
structure. For this, the following items need to be setup:
<ul>
<li>Root POM, if there is any, is converted to a skeleton POM file</li>
<li>A mapping XML file defining each module and its root POM</li>
<li>A release manifest, listing the modules that will be released.</li>
</ul>
</p>

<h4>Skeleton POM</h4>
<p>Suppose our project which has three modules has the following root POM:<br/>
<pre>
&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.redhat.project&lt;/groupId&gt;
  &lt;artifactId&gt;root&lt;/artifactId&gt;
  &lt;version&gt;1.0&lt;/version&gt;
  &lt;dependencies&gt;
    ...
  &lt;/dependencies&gt;
  &lt;dependencyManagement&gt;
    ...
  &lt;/dependencyManagement&gt;
  &lt;modules&gt;
    &lt;module&gt;m1&lt;/module&gt;
    &lt;module&gt;m2&lt;/module&gt;
    &lt;module&gt;m3&lt;/module&gt;
  &lt;/modules&gt;
&lt;/project&gt;
</pre>
</p>
<p>We modify this POM file to a skeleton POM file. Pomutils will use
        this skeleton POM file to generate a new root POM containing
        only the modules that needs to be built. The skeleton POM file
        contains the same items as the original POM file, except the
        modules:<br/>
skel.pom.xml:
<pre>
&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.redhat.project&lt;/groupId&gt;
  &lt;artifactId&gt;root&lt;/artifactId&gt;
  &lt;version&gt;1.0&lt;/version&gt;
  &lt;dependencies&gt;
    ...
  &lt;/dependencies&gt;
  &lt;dependencyManagement&gt;
    ...
  &lt;/dependencyManagement&gt;
  &lt;modules&gt;
  &lt;/modules&gt;
&lt;/project&gt;
</pre></p>

<p>This skeleton file does not change from release to release.</p>

<h4>Mapping file</h4>
<p>The mapping XML file contains all the submodules, and their POM
        file locations:<br>
all.mf.xml:
<pre>
&lt;manifest xmlns="http://www.redhat.com/build/manifest/1"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;

  &lt;modulemap&gt;
     &lt;module&gt;
        &lt;name&gt;m1&lt;/name&gt;
        &lt;pom&gt;m1/pom.xml&lt;/pom&gt;
     &lt;/module&gt;
     &lt;module&gt;
        &lt;name&gt;m2&lt;/name&gt;
        &lt;pom&gt;m2/pom.xml&lt;/pom&gt;
     &lt;/module&gt;
     &lt;module&gt;
        &lt;name&gt;m3&lt;/name&gt;
        &lt;pom&gt;m3/pom.xml&lt;/pom&gt;
     &lt;/module&gt;
  &lt;/modulemap&gt;
&lt;/manifest&gt;
</pre></p>
<p>Note that the modules in the original root POM is now listed
        here.</p>
<p>This mapping file does not change from release to release. It only
        changes when new modules are added, or existing modules are
        removed, or moved somewhere else.</p>

<h4>Release Manifest</h4>
<p>A release manifest is created for each release. It lists the
        modules that will be included in the release.<br/>
release.xml:
<pre>
&lt;manifest&gt;
  &lt;buildset&gt;
    &lt;module&gt;m1&lt;/module&gt;
    &lt;module&gt;m3&lt;/module&gt;
  &lt;/buildset&gt;
&lt;/manifest&gt;
</pre></p>

<h4>Generating a root POM for a release</h4>
<p>Run</br>
<pre>
    pomutil -rrelease.xml -omf.pom.xml -sskel.pom.xml -lall.mf.xml
        -opom.xml
</pre>
This command does the following:
<ul>
<li>Determines which modules need to be built based on
        <code>release.xml</code></li>
<li>Determines if there are any other modules in
        <code>all.mf.xml</code> that need to be built. Any module that
        depends on the current build set needs to be rebuilt.</li>
<li>Reads the <code>skel.pom.xml</code>, adds all the modules that
        need to be built into the modules section, and writes it as
        <code>pom.xml</code></li>
</ul>
</p>

<h3>Using POM fragments instead of POM inheritance</h3>

<p>Using fragments, Maven POM files can be broken into modules that
can be included into other POM files. As an example, consider a
project contining modules that use Jboss, RestEasy, and Spring, but
not all modules use all three. These frameworks come with their own
set of dependencies. You can prepare three XML files,
<code>jboss.xml</code>, <code>rest.xml</code>, and
<code>spring.xml</code> containing dependencies used by these
frameworks. A module using only JBoss will include
<code>jboss.xml</code>, another module using JBoss and RestEasy will
include <code>jboss.xml</code> and <code>rest.xml</code>.</p>

<p>Fragments are XML files of the following format:<br/>
<pre>
&lt;fragment&gt;
    &lt;!-- Any valid XML content  --&gt;
&lt;/fragment&gt;
</pre></p>

<p>For instance, <code>rest.xml</code> looks like this:<br/>
<pre>
&lt;fragment&gt;
   &lt;dependency&gt;
     &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
     &lt;artifactId&gt;resteasy-jaxrs&lt;/artifactId&gt;
     &lt;version&gt;2.2.1.GA&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
     &lt;groupId&gt;com.sun.xml.bind&lt;/groupId&gt;
     &lt;artifactId&gt;jaxb-impl&lt;/artifactId&gt;
     &lt;version&gt;2.2.4&lt;/version&gt;
     &lt;scope&gt;provided&lt;/scope&gt;
   &lt;/dependency&gt;
    ....
&lt;/fragment&gt;
</pre></p>
<p>To include fragments in a POM file:<br/>
<pre>
&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;mygroup&lt;/groupId&gt;
  &lt;artifactId&gt;myartifact&lt;/artifactId&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  &lt;version&gt;1.0&lt;/version&gt;
  &lt;dependencies&gt;
&lt;!--Fragment: rest.xml --&gt;
&lt;!--Fragment: jboss.xml --&gt;
  &lt;/dependencies&gt;
  ...
</pre>
<p>The above project includes both the RestEasy and JBoss
              dependencies.</p>
<p>To generate or update the POM file, run<br/>
<pre>
    xmlfrag -ffragments/ pom.xml
</pre>
<p>Here, <code>-ffragment/</code> give the directory containing the
XML fragments. When run, <code>xmlfrag</code> inserts the contents of
the fragment XMLs into the POM file.</p> <p>If fragments are updated,
running xmlfrag again will update the POM files with the new content.</p>

      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/bserdar">bserdar</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
